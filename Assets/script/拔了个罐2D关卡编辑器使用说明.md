# æ‹”äº†ä¸ªç½2Då…³å¡ç¼–è¾‘å™¨ - Scriptç›®å½•é›†æˆç‰ˆ

## ğŸ“‹ æ¦‚è¿°

æ‹”äº†ä¸ªç½2Då…³å¡ç¼–è¾‘å™¨å·²æˆåŠŸé›†æˆåˆ° `Assets/script` ç›®å½•ä¸­ï¼Œæä¾›äº†å®Œæ•´çš„ä¸è§„åˆ™å›¾å½¢æ”¯æŒå’Œå…³å¡ç¼–è¾‘åŠŸèƒ½ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### ä¸è§„åˆ™å›¾å½¢æ”¯æŒ
- âœ… **å¤šå±‚ä¸è§„åˆ™å›¾å½¢** - æ¯å±‚å¯æ”¾ç½®ä¸åŒçš„ä¸è§„åˆ™å›¾å½¢
- âœ… **åŒºåŸŸé™åˆ¶** - å¡ç‰‡åªèƒ½æ”¾ç½®åœ¨ä¸è§„åˆ™å›¾å½¢å†…
- âœ… **é¢„è®¾å›¾å½¢åº“** - åœ†å½¢ã€æ˜Ÿå½¢ã€çŸ©å½¢ã€ä¸‰è§’å½¢
- âœ… **å®æ—¶å¯è§†åŒ–** - å›¾å½¢è¾¹ç•Œå®æ—¶æ˜¾ç¤º

### å…³å¡ç¼–è¾‘åŠŸèƒ½
- âœ… **å¤šå±‚ç®¡ç†** - æ”¯æŒå¤šä¸ªå±‚çº§
- âœ… **ç½‘æ ¼ç³»ç»Ÿ** - ç²¾ç¡®çš„ç½‘æ ¼å¯¹é½
- âœ… **å¡ç‰‡ç®¡ç†** - æ·»åŠ ã€åˆ é™¤ã€ç¼–è¾‘å¡ç‰‡
- âœ… **å…³å¡éªŒè¯** - è‡ªåŠ¨æ£€æŸ¥å…³å¡æœ‰æ•ˆæ€§

## ğŸ“ æ–‡ä»¶ç»“æ„

```
Assets/script/
â”œâ”€â”€ CuppingLevelEditor2D.cs           # ä¸»ç¼–è¾‘å™¨ç±»
â”œâ”€â”€ CuppingLevelEditorMenu.cs         # Unityèœå•ç³»ç»Ÿ
â”œâ”€â”€ LevelValidator2D.cs               # å…³å¡éªŒè¯å™¨
â”œâ”€â”€ CuppingLevelEditorTest.cs         # æµ‹è¯•è„šæœ¬
â”œâ”€â”€ PlaceableAreaVisualizer.cs        # å¯æ”¾ç½®åŒºåŸŸå¯è§†åŒ–
â”œâ”€â”€ GUIEventManager.cs                # GUIäº‹ä»¶ç®¡ç†
â””â”€â”€ æ‹”äº†ä¸ªç½2Då…³å¡ç¼–è¾‘å™¨ä½¿ç”¨è¯´æ˜.md    # æœ¬è¯´æ˜æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºç¼–è¾‘å™¨å¯¹è±¡

#### æ–¹æ³•ä¸€ï¼šé€šè¿‡èœå•
1. åœ¨Unityèœå•æ é€‰æ‹© `æ‹”äº†ä¸ªç½ > å¿«é€Ÿè®¾ç½®`
2. ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºç¼–è¾‘å™¨å¯¹è±¡å¹¶æ·»åŠ é¢„è®¾å›¾å½¢

#### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨åˆ›å»º
```csharp
// åˆ›å»ºç¼–è¾‘å™¨å¯¹è±¡
GameObject editorObj = new GameObject("æ‹”äº†ä¸ªç½2Då…³å¡ç¼–è¾‘å™¨");
CuppingLevelEditor2D editor = editorObj.AddComponent<CuppingLevelEditor2D>();

// è®¾ç½®åŸºæœ¬å‚æ•°
editor.gridSize = new Vector2(10, 10);
editor.cardSpacing = 1.2f;
editor.cardSize = new Vector2(1, 1);
editor.totalLayers = 3;
```

### 2. æ·»åŠ ä¸è§„åˆ™å›¾å½¢

```csharp
// æ·»åŠ é¢„è®¾å›¾å½¢
editor.AddPresetShape(0, 0); // åœ†å½¢åœ¨å±‚çº§0
editor.AddPresetShape(1, 1); // æ˜Ÿå½¢åœ¨å±‚çº§1
editor.AddPresetShape(2, 2); // çŸ©å½¢åœ¨å±‚çº§2
editor.AddPresetShape(3, 0); // ä¸‰è§’å½¢åœ¨å±‚çº§0
```

### 3. ç¼–è¾‘å…³å¡

```csharp
// åˆ›å»ºæ–°å…³å¡
editor.NewLevel();

// æ·»åŠ å¡ç‰‡
CardData2D card = new CardData2D
{
    id = 1,
    type = 0,
    position = new Vector2(0, 0),
    layer = 0,
    isVisible = true
};
editor.AddCardData(card);

// ä¿å­˜å…³å¡
editor.SaveLevel();
```

## ğŸ® ä½¿ç”¨æ–¹æ³•

### Unityèœå•æ“ä½œ

#### åŸºæœ¬æ“ä½œ
- `æ‹”äº†ä¸ªç½ > æ–°å»ºå…³å¡` - åˆ›å»ºæ–°å…³å¡
- `æ‹”äº†ä¸ªç½ > ä¿å­˜å…³å¡` - ä¿å­˜å½“å‰å…³å¡
- `æ‹”äº†ä¸ªç½ > åŠ è½½å…³å¡` - åŠ è½½å·²æœ‰å…³å¡
- `æ‹”äº†ä¸ªç½ > å¯¼å‡ºå…³å¡` - å¯¼å‡ºå…³å¡æ–‡ä»¶
- `æ‹”äº†ä¸ªç½ > éªŒè¯å…³å¡` - éªŒè¯å…³å¡æœ‰æ•ˆæ€§

#### ä¸è§„åˆ™å›¾å½¢æ“ä½œ
- `æ‹”äº†ä¸ªç½ > æ·»åŠ é¢„è®¾å›¾å½¢ > åœ†å½¢` - æ·»åŠ åœ†å½¢å›¾å½¢
- `æ‹”äº†ä¸ªç½ > æ·»åŠ é¢„è®¾å›¾å½¢ > æ˜Ÿå½¢` - æ·»åŠ æ˜Ÿå½¢å›¾å½¢
- `æ‹”äº†ä¸ªç½ > æ·»åŠ é¢„è®¾å›¾å½¢ > çŸ©å½¢` - æ·»åŠ çŸ©å½¢å›¾å½¢
- `æ‹”äº†ä¸ªç½ > æ·»åŠ é¢„è®¾å›¾å½¢ > ä¸‰è§’å½¢` - æ·»åŠ ä¸‰è§’å½¢å›¾å½¢
- `æ‹”äº†ä¸ªç½ > æ¸…é™¤æ‰€æœ‰ä¸è§„åˆ™å›¾å½¢` - æ¸…é™¤æ‰€æœ‰å›¾å½¢

#### å¿«é€Ÿè®¾ç½®
- `æ‹”äº†ä¸ªç½ > å¿«é€Ÿè®¾ç½®` - ä¸€é”®è®¾ç½®é»˜è®¤å‚æ•°å’Œé¢„è®¾å›¾å½¢

### è¿è¡Œæ—¶æ“ä½œ

#### é¼ æ ‡æ“ä½œ
- **å·¦é”®ç‚¹å‡»** - åœ¨å¯æ”¾ç½®åŒºåŸŸæ”¾ç½®å¡ç‰‡
- **å³é”®ç‚¹å‡»** - åˆ é™¤æŒ‡å®šä½ç½®çš„å¡ç‰‡
- **é¼ æ ‡æ»šè½®** - åˆ‡æ¢å½“å‰å±‚çº§
- **ä¸­é”®æ‹–æ‹½** - ç§»åŠ¨ç›¸æœºè§†è§’
- **æ»šè½®ç¼©æ”¾** - ç¼©æ”¾ç›¸æœº

#### é”®ç›˜æ“ä½œ
- **æ•°å­—é”® 1-9** - åˆ‡æ¢å¡ç‰‡ç±»å‹
- **ç©ºæ ¼é”®** - åˆ‡æ¢ç¼–è¾‘æ¨¡å¼

## âš™ï¸ é…ç½®é€‰é¡¹

### ç½‘æ ¼è®¾ç½®
```csharp
editor.gridSize = new Vector2(10, 10);        // ç½‘æ ¼å¤§å°
editor.cardSpacing = 1.2f;                    // å¡ç‰‡é—´è·
editor.cardSize = new Vector2(1, 1);          // å¡ç‰‡å¤§å°
editor.totalLayers = 3;                       // æ€»å±‚çº§æ•°
```

### å¯è§†åŒ–è®¾ç½®
```csharp
editor.showGrid = true;                       // æ˜¾ç¤ºç½‘æ ¼
editor.showPlaceableArea = true;              // æ˜¾ç¤ºå¯æ”¾ç½®åŒºåŸŸ
editor.showIrregularShapes = true;            // æ˜¾ç¤ºä¸è§„åˆ™å›¾å½¢
editor.placeableAreaColor = Color.green;      // å¯æ”¾ç½®åŒºåŸŸé¢œè‰²
editor.gridLineColor = Color.white;           // ç½‘æ ¼çº¿é¢œè‰²
```

### ä¸è§„åˆ™å›¾å½¢è®¾ç½®
```csharp
editor.irregularShapeColor = Color.cyan;      // å›¾å½¢é¢œè‰²
editor.irregularShapeAlpha = 0.3f;            // å›¾å½¢é€æ˜åº¦
editor.snapToIrregularShape = true;           // å¯¹é½åˆ°å›¾å½¢
```

### åŒºåŸŸè®¾ç½®
```csharp
editor.useCustomAreaSize = true;              // ä½¿ç”¨è‡ªå®šä¹‰åŒºåŸŸå¤§å°
editor.areaSize = new Vector2(16f, 16f);      // è‡ªå®šä¹‰åŒºåŸŸå¤§å°
```

### å±‚çº§é¢„è§ˆè®¾ç½®
```csharp
editor.enableLayerPreview = true;             // å¯ç”¨å±‚çº§é¢„è§ˆ
editor.normalLayerColor = Color.white;        // æ­£å¸¸å±‚çº§é¢œè‰²
editor.grayedLayerColor = new Color(0.5f, 0.5f, 0.5f, 0.5f); // ç½®ç°å±‚çº§é¢œè‰²
```

## ğŸ”§ APIå‚è€ƒ

### ä¸»è¦æ–¹æ³•

#### å…³å¡ç®¡ç†
```csharp
public void NewLevel()                        // åˆ›å»ºæ–°å…³å¡
public void SaveLevel()                       // ä¿å­˜å…³å¡
public void LoadLevel(int levelId)            // åŠ è½½å…³å¡
public void ExportLevel()                     // å¯¼å‡ºå…³å¡
public void ValidateCurrentLevel()            // éªŒè¯å…³å¡
```

#### ä¸è§„åˆ™å›¾å½¢ç®¡ç†
```csharp
public void AddPresetShape(int presetIndex, int targetLayer)  // æ·»åŠ é¢„è®¾å›¾å½¢
public void RemoveIrregularShape(int index)                   // åˆ é™¤å›¾å½¢
public bool IsPositionInIrregularShapes(Vector2 position, int layer) // æ£€æŸ¥ä½ç½®
```

#### å¡ç‰‡ç®¡ç†
```csharp
public void AddCardData(CardData2D cardData)  // æ·»åŠ å¡ç‰‡
public void ClearCardObjects()                // æ¸…é™¤å¡ç‰‡å¯¹è±¡
public void UpdateCardDisplay()               // æ›´æ–°å¡ç‰‡æ˜¾ç¤º
```

#### å·¥å…·æ–¹æ³•
```csharp
public Vector2 SnapToGrid2D(Vector2 worldPos) // ç½‘æ ¼å¯¹é½
public Vector2 GetActualAreaSize()            // è·å–å®é™…åŒºåŸŸå¤§å°
```

### æ•°æ®ç»“æ„

#### CardData2D
```csharp
public class CardData2D
{
    public int id;                            // å¡ç‰‡ID
    public int type;                          // å¡ç‰‡ç±»å‹
    public Vector2 position;                  // ä½ç½®
    public int layer;                         // å±‚çº§
    public bool isVisible;                    // æ˜¯å¦å¯è§
    public List<int> blockingCards;           // é˜»æŒ¡å¡ç‰‡åˆ—è¡¨
}
```

#### IrregularShapeData
```csharp
public class IrregularShapeData
{
    public int layer;                         // æ‰€å±å±‚çº§
    public List<Vector2> vertices;            // é¡¶ç‚¹åˆ—è¡¨
    public Color shapeColor;                  // å›¾å½¢é¢œè‰²
    public bool isActive;                     // æ˜¯å¦æ¿€æ´»
}
```

## ğŸ§ª æµ‹è¯•

### ä½¿ç”¨æµ‹è¯•è„šæœ¬
1. å°† `CuppingLevelEditorTest.cs` æ·»åŠ åˆ°åœºæ™¯ä¸­çš„GameObject
2. åœ¨Inspectorä¸­é…ç½®æµ‹è¯•å‚æ•°
3. è¿è¡Œåœºæ™¯æˆ–ç‚¹å‡»"è¿è¡Œæµ‹è¯•"æŒ‰é’®

### æµ‹è¯•åŠŸèƒ½
- âœ… åŸºæœ¬åŠŸèƒ½æµ‹è¯•
- âœ… ä¸è§„åˆ™å›¾å½¢æµ‹è¯•
- âœ… å…³å¡åˆ›å»ºæµ‹è¯•
- âœ… éªŒè¯åŠŸèƒ½æµ‹è¯•

## ğŸ“ æ–‡ä»¶ä¿å­˜

### å…³å¡æ–‡ä»¶ä½ç½®
```
Assets/script/Levels/
â”œâ”€â”€ Level2D_1.json
â”œâ”€â”€ Level2D_2.json
â””â”€â”€ ...
```

### æ–‡ä»¶æ ¼å¼
- **JSONæ ¼å¼** - ä¸»è¦æ ¼å¼ï¼Œæ˜“äºç¼–è¾‘
- **XMLæ ¼å¼** - å¯¼å‡ºæ ¼å¼ï¼Œå…¼å®¹æ€§å¥½

## ğŸ” è°ƒè¯•

### è°ƒè¯•æ¨¡å¼
```csharp
editor.debugMode = true;                     // å¯ç”¨è°ƒè¯•æ¨¡å¼
```

### è°ƒè¯•ä¿¡æ¯
- å½“å‰å±‚çº§
- å¡ç‰‡æ•°é‡
- ä¸è§„åˆ™å›¾å½¢æ•°é‡
- é¼ æ ‡ä½ç½®
- ç›¸æœºä½ç½®å’Œå¤§å°

## âš ï¸ æ³¨æ„äº‹é¡¹

### æ€§èƒ½ä¼˜åŒ–
- ä½¿ç”¨ `highPerformanceMode = true` æé«˜æ€§èƒ½
- è°ƒæ•´ `inputThrottle` æ§åˆ¶è¾“å…¥é¢‘ç‡
- åˆç†è®¾ç½® `textureSize` å¹³è¡¡è´¨é‡å’Œæ€§èƒ½

### å…¼å®¹æ€§
- ç¡®ä¿æ‰€æœ‰ä¾èµ–è„šæœ¬éƒ½åœ¨ `Assets/script` ç›®å½•ä¸­
- æ£€æŸ¥ `PlaceableAreaVisualizer.cs` å’Œ `GUIEventManager.cs` æ˜¯å¦å­˜åœ¨

### æ–‡ä»¶è·¯å¾„
- å…³å¡æ–‡ä»¶ä¿å­˜åœ¨ `Assets/script/Levels/` ç›®å½•
- ç¡®ä¿ç›®å½•å­˜åœ¨ä¸”æœ‰å†™å…¥æƒé™

## ğŸ‰ æ€»ç»“

æ‹”äº†ä¸ªç½2Då…³å¡ç¼–è¾‘å™¨å·²æˆåŠŸé›†æˆåˆ°scriptç›®å½•ä¸­ï¼Œæä¾›äº†ï¼š

- âœ… **å®Œæ•´çš„ä¸è§„åˆ™å›¾å½¢æ”¯æŒ**
- âœ… **ç›´è§‚çš„Unityèœå•æ“ä½œ**
- âœ… **å¼ºå¤§çš„å…³å¡ç¼–è¾‘åŠŸèƒ½**
- âœ… **è‡ªåŠ¨çš„å…³å¡éªŒè¯ç³»ç»Ÿ**
- âœ… **è¯¦ç»†çš„APIæ–‡æ¡£**

ç°åœ¨æ‚¨å¯ä»¥å¼€å§‹ä½¿ç”¨è¿™ä¸ªå¼ºå¤§çš„2Då…³å¡ç¼–è¾‘å™¨æ¥åˆ›å»ºç²¾å½©çš„æ¸¸æˆå…³å¡äº†ï¼ğŸ®âœ¨ 